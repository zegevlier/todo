"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cookie = void 0;
const cookie = () => {
    return async (c, next) => {
        c.req.cookie = ((name) => {
            const cookie = c.req.headers.get('Cookie') || '';
            const obj = parse(cookie);
            if (name) {
                const value = obj[name];
                return value;
            }
            else {
                return obj;
            }
        });
        c.cookie = (name, value, opt) => {
            const cookie = serialize(name, value, opt);
            c.header('Set-Cookie', cookie);
        };
        await next();
    };
};
exports.cookie = cookie;
const parse = (cookie) => {
    const pairs = cookie.split(/;\s*/g);
    const parsedCookie = {};
    for (let i = 0, len = pairs.length; i < len; i++) {
        const pair = pairs[i].split(/\s*=\s*([^\s]+)/);
        parsedCookie[pair[0]] = decodeURIComponent(pair[1]);
    }
    return parsedCookie;
};
const serialize = (name, value, opt = {}) => {
    value = encodeURIComponent(value);
    let cookie = `${name}=${value}`;
    if (opt.maxAge) {
        cookie += `; Max-Age=${Math.floor(opt.maxAge)}`;
    }
    if (opt.domain) {
        cookie += '; Domain=' + opt.domain;
    }
    if (opt.path) {
        cookie += '; Path=' + opt.path;
    }
    if (opt.expires) {
        cookie += '; Expires=' + opt.expires.toUTCString();
    }
    if (opt.httpOnly) {
        cookie += '; HttpOnly';
    }
    if (opt.secure) {
        cookie += '; Secure';
    }
    if (opt.sameSite) {
        cookie += `; SameSite=${opt.sameSite}`;
    }
    return cookie;
};
